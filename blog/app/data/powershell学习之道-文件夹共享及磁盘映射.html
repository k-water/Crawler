<blockquote>
<p>在Linux环境下，我们很轻易就能得心应手地通过命令操作一切事物，在Windows下，Powershell也算是后起之秀，提供大量的cmdlet以及c#的横向拓展。下面将由小编带领大家通过Powershell实现文件夹共享，当然文中也不会冷落cmd这枚老将。</p>
</blockquote>
<h3 id="文件夹共享概述"><a href="#文件夹共享概述" class="headerlink" title="文件夹共享概述"></a>文件夹共享概述</h3><p>共享文件夹的应用非常广泛，客户端对服务器端进行文件管理，局域网文件直传等等，在linux下，可以简单的安装smaba协议，简单的配置之后即可使用。在windows下，可以通过图形化的操作开启这项功能，当然带着一点极客风格，我们通过powershell（少量出现cmd）来对其进行管理。</p>
<a id="more"></a>
<h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><h4 id="查看共享列表"><a href="#查看共享列表" class="headerlink" title="查看共享列表"></a>查看共享列表</h4><p>在powershell内，我们可以通过执行以下cmdlet获取共享信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">λ Get-WmiObject -Class Win32_Share</div><div class="line"></div><div class="line">Name                                      Path                                      Description</div><div class="line">----                                      ----                                      -----------</div><div class="line">ADMIN$                                    C:\Windows                                远程管理</div><div class="line">C$                                        C:\                                       默认共享</div><div class="line">D$                                        D:\                                       默认共享</div><div class="line">E$                                        E:\                                       默认共享</div><div class="line">IPC$                                                                                远程 IPC</div><div class="line">Users                                     C:\Users</div></pre></td></tr></table></figure>
<p>同理，在cmd下，也可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">λ net share</div><div class="line"></div><div class="line">共享名       资源                            注解</div><div class="line"></div><div class="line">-------------------------------------------------------------------------------</div><div class="line">C$           C:\                             默认共享</div><div class="line">D$           D:\                             默认共享</div><div class="line">E$           E:\                             默认共享</div><div class="line">IPC$                                         远程 IPC</div><div class="line">ADMIN$       C:\Windows                      远程管理</div><div class="line">Users        C:\Users</div><div class="line">命令成功完成。</div></pre></td></tr></table></figure>
<h4 id="创建一个共享文件夹"><a href="#创建一个共享文件夹" class="headerlink" title="创建一个共享文件夹"></a>创建一个共享文件夹</h4><p><strong>疯狂的Powershell</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 共享名</div><div class="line">$ShareName = &apos;TestShare&apos;</div><div class="line"># 共享路径</div><div class="line">$Path = &apos;D:\SHARE&apos;</div><div class="line"></div><div class="line">If (!(Get-WmiObject -Class Win32_Share -Filter &quot;name=&apos;$ShareName&apos;&quot;))</div><div class="line">&#123;</div><div class="line">	$Shares = [WMICLASS]&quot;WIN32_Share&quot;</div><div class="line">	$Shares.Create($Path,$ShareName,0).ReturnValue</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">	Write-Warning &quot;$ShareName has been sharing!!&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果如果您有远程机器的管理员权限的话，也利用WMI在远程的机器上创建新的共享文件夹，下面是在远程主机上创建共享文件夹的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># 共享名</div><div class="line">$ShareName = &apos;TestShare&apos;</div><div class="line"># 共享路径</div><div class="line">$Path = &apos;D:\SHARE&apos;</div><div class="line"># 远程主机名</div><div class="line">$Server = &apos;Server&apos;</div><div class="line"></div><div class="line">If (!(Get-WmiObject -Class Win32_Share -Filter &quot;name=&apos;$ShareName&apos;&quot;))</div><div class="line">&#123;</div><div class="line">	$Shares = [WMICLASS]&quot;\\$Server\root\cimv2:WIN32_Share&quot;</div><div class="line">	$Shares.Create($Path,$ShareName,0).ReturnValue</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">	Write-Warning &quot;$ShareName has been sharing!!&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>低调的cmd</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">::建议先查看当前的共享文件夹再进行创建操作</div><div class="line">net share TestShare=D:\SHARE /users:25 /remark:&quot;test share of the a folder&quot;</div></pre></td></tr></table></figure>
<p>我们很轻易地就能将一个文件夹的共享状态开启，我们可以通过UNC路径对其进行访问。创建完文件共享之后，我们来看看怎么使用吧。</p>
<h4 id="驱动器映射和共享访问"><a href="#驱动器映射和共享访问" class="headerlink" title="驱动器映射和共享访问"></a>驱动器映射和共享访问</h4><p>接下来，我们摒弃图形化界面的操作（如果你非喜欢那么做的话，可以通过网上邻居【“网络”】进行查看，或者在计算机图标下右键选择映射网络驱动器），我们来通过命令去启用吧。</p>
<p><strong>强悍的Powershell</strong></p>
<p>临时创建一个网络驱动器映射：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(New-Object -ComObject WScript.Network).MapNetworkDrive(&quot;Z:&quot;, &quot;\\TEST-PC\USERS&quot;)</div></pre></td></tr></table></figure></p>
<p>创建一个持久化的网络驱动器映射：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># New-PSDrive 加上 -Persist 参数使得驱动器在 PowerShell 之外可见。</div><div class="line"># 要真正地创建一个永久的网络驱动器，请确保加上 -Scope Global。/</div><div class="line"># 如果 New-PSDrive 在全局作用域范围之外运行（例如，在一个脚本中运行），该驱动器只会在脚本运行时出现在文件管理器中。</div><div class="line">New-PSDrive -Name Z -PSProvider FileSystem -Root \\TEST-PC\USERS -Persist -Scope Global</div></pre></td></tr></table></figure></p>
<p><strong>小巧的cmd</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">::下面这条命令虽然可以在cmd使用此磁盘映射，但是不可利用资源管理器加载。</div><div class="line">net use Z: \\TEST-PC\USERS</div><div class="line"></div><div class="line">::这里是将systemroot文件夹映射为z:驱动器，可利用&quot;explorer.exe&quot;加载，可惜不能使用网络路径。</div><div class="line">subst Z: $env:systemroot</div></pre></td></tr></table></figure>
<p>完成如上的工作之后，不出意外，你的资源管理器会出现你想要访问的网络路径的图标。</p>
<h4 id="删除共享"><a href="#删除共享" class="headerlink" title="删除共享"></a>删除共享</h4><p>如果不需要再使用此共享文件夹了，可以卸载掉网络驱动器，并在共享的主机上删除该共享。</p>
<p><strong>Powershell</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$Shares = Get-WMIObject Win32_Share | Where &#123;$_.Name -eq &quot;&quot;&#125;</div><div class="line"></div><div class="line">Foreach ($Share in $Shares) &#123;</div><div class="line">   $Share.Delete()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>cmd</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net share TestShare /delete</div></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ol><br>    <li>建立共享文件夹需要事先在启用网络共享和发现。</li><br>  <li>需要提前做好文件夹权限控制以及共享的权限控制。</li><br>  <li>通过配置cmdkey可以免去身份认证 <code>cmdkey /add:targetname /user:username /pass:password</code></li><br></ol>

<p>Powershell管理共享的相关链接：<a href="https://msdn.microsoft.com/en-us/library/aa394435(v=vs.85).aspx" target="_blank">https://msdn.microsoft.com/en-us/library/aa394435(v=vs.85).aspx</a></p><blockquote>
<p>在Linux环境下，我们很轻易就能得心应手地通过命令操作一切事物，在Windows下，Powershell也算是后起之秀，提供大量的cmdlet以及c#的横向拓展。下面将由小编带领大家通过Powershell实现文件夹共享，当然文中也不会冷落cmd这枚老将。</p>
</blockquote>
<h3 id="文件夹共享概述"><a href="#文件夹共享概述" class="headerlink" title="文件夹共享概述"></a>文件夹共享概述</h3><p>共享文件夹的应用非常广泛，客户端对服务器端进行文件管理，局域网文件直传等等，在linux下，可以简单的安装smaba协议，简单的配置之后即可使用。在windows下，可以通过图形化的操作开启这项功能，当然带着一点极客风格，我们通过powershell（少量出现cmd）来对其进行管理。</p>
<a id="more"></a>
<h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><h4 id="查看共享列表"><a href="#查看共享列表" class="headerlink" title="查看共享列表"></a>查看共享列表</h4><p>在powershell内，我们可以通过执行以下cmdlet获取共享信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">λ Get-WmiObject -Class Win32_Share</div><div class="line"></div><div class="line">Name                                      Path                                      Description</div><div class="line">----                                      ----                                      -----------</div><div class="line">ADMIN$                                    C:\Windows                                远程管理</div><div class="line">C$                                        C:\                                       默认共享</div><div class="line">D$                                        D:\                                       默认共享</div><div class="line">E$                                        E:\                                       默认共享</div><div class="line">IPC$                                                                                远程 IPC</div><div class="line">Users                                     C:\Users</div></pre></td></tr></table></figure>
<p>同理，在cmd下，也可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">λ net share</div><div class="line"></div><div class="line">共享名       资源                            注解</div><div class="line"></div><div class="line">-------------------------------------------------------------------------------</div><div class="line">C$           C:\                             默认共享</div><div class="line">D$           D:\                             默认共享</div><div class="line">E$           E:\                             默认共享</div><div class="line">IPC$                                         远程 IPC</div><div class="line">ADMIN$       C:\Windows                      远程管理</div><div class="line">Users        C:\Users</div><div class="line">命令成功完成。</div></pre></td></tr></table></figure>
<h4 id="创建一个共享文件夹"><a href="#创建一个共享文件夹" class="headerlink" title="创建一个共享文件夹"></a>创建一个共享文件夹</h4><p><strong>疯狂的Powershell</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 共享名</div><div class="line">$ShareName = &apos;TestShare&apos;</div><div class="line"># 共享路径</div><div class="line">$Path = &apos;D:\SHARE&apos;</div><div class="line"></div><div class="line">If (!(Get-WmiObject -Class Win32_Share -Filter &quot;name=&apos;$ShareName&apos;&quot;))</div><div class="line">&#123;</div><div class="line">	$Shares = [WMICLASS]&quot;WIN32_Share&quot;</div><div class="line">	$Shares.Create($Path,$ShareName,0).ReturnValue</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">	Write-Warning &quot;$ShareName has been sharing!!&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果如果您有远程机器的管理员权限的话，也利用WMI在远程的机器上创建新的共享文件夹，下面是在远程主机上创建共享文件夹的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># 共享名</div><div class="line">$ShareName = &apos;TestShare&apos;</div><div class="line"># 共享路径</div><div class="line">$Path = &apos;D:\SHARE&apos;</div><div class="line"># 远程主机名</div><div class="line">$Server = &apos;Server&apos;</div><div class="line"></div><div class="line">If (!(Get-WmiObject -Class Win32_Share -Filter &quot;name=&apos;$ShareName&apos;&quot;))</div><div class="line">&#123;</div><div class="line">	$Shares = [WMICLASS]&quot;\\$Server\root\cimv2:WIN32_Share&quot;</div><div class="line">	$Shares.Create($Path,$ShareName,0).ReturnValue</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">	Write-Warning &quot;$ShareName has been sharing!!&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>低调的cmd</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">::建议先查看当前的共享文件夹再进行创建操作</div><div class="line">net share TestShare=D:\SHARE /users:25 /remark:&quot;test share of the a folder&quot;</div></pre></td></tr></table></figure>
<p>我们很轻易地就能将一个文件夹的共享状态开启，我们可以通过UNC路径对其进行访问。创建完文件共享之后，我们来看看怎么使用吧。</p>
<h4 id="驱动器映射和共享访问"><a href="#驱动器映射和共享访问" class="headerlink" title="驱动器映射和共享访问"></a>驱动器映射和共享访问</h4><p>接下来，我们摒弃图形化界面的操作（如果你非喜欢那么做的话，可以通过网上邻居【“网络”】进行查看，或者在计算机图标下右键选择映射网络驱动器），我们来通过命令去启用吧。</p>
<p><strong>强悍的Powershell</strong></p>
<p>临时创建一个网络驱动器映射：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(New-Object -ComObject WScript.Network).MapNetworkDrive(&quot;Z:&quot;, &quot;\\TEST-PC\USERS&quot;)</div></pre></td></tr></table></figure></p>
<p>创建一个持久化的网络驱动器映射：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># New-PSDrive 加上 -Persist 参数使得驱动器在 PowerShell 之外可见。</div><div class="line"># 要真正地创建一个永久的网络驱动器，请确保加上 -Scope Global。/</div><div class="line"># 如果 New-PSDrive 在全局作用域范围之外运行（例如，在一个脚本中运行），该驱动器只会在脚本运行时出现在文件管理器中。</div><div class="line">New-PSDrive -Name Z -PSProvider FileSystem -Root \\TEST-PC\USERS -Persist -Scope Global</div></pre></td></tr></table></figure></p>
<p><strong>小巧的cmd</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">::下面这条命令虽然可以在cmd使用此磁盘映射，但是不可利用资源管理器加载。</div><div class="line">net use Z: \\TEST-PC\USERS</div><div class="line"></div><div class="line">::这里是将systemroot文件夹映射为z:驱动器，可利用&quot;explorer.exe&quot;加载，可惜不能使用网络路径。</div><div class="line">subst Z: $env:systemroot</div></pre></td></tr></table></figure>
<p>完成如上的工作之后，不出意外，你的资源管理器会出现你想要访问的网络路径的图标。</p>
<h4 id="删除共享"><a href="#删除共享" class="headerlink" title="删除共享"></a>删除共享</h4><p>如果不需要再使用此共享文件夹了，可以卸载掉网络驱动器，并在共享的主机上删除该共享。</p>
<p><strong>Powershell</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$Shares = Get-WMIObject Win32_Share | Where &#123;$_.Name -eq &quot;&quot;&#125;</div><div class="line"></div><div class="line">Foreach ($Share in $Shares) &#123;</div><div class="line">   $Share.Delete()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>cmd</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net share TestShare /delete</div></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ol><br>    <li>建立共享文件夹需要事先在启用网络共享和发现。</li><br>  <li>需要提前做好文件夹权限控制以及共享的权限控制。</li><br>  <li>通过配置cmdkey可以免去身份认证 <code>cmdkey /add:targetname /user:username /pass:password</code></li><br></ol>

<p>Powershell管理共享的相关链接：<a href="https://msdn.microsoft.com/en-us/library/aa394435(v=vs.85).aspx" target="_blank">https://msdn.microsoft.com/en-us/library/aa394435(v=vs.85).aspx</a></p>